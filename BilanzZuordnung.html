<!doctype html>
<html lang="de-CH">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interaktive Bilanz-Zuordnung</title>
  <style>
    :root {
      --bg: #edf6ef;
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #4b5563;
      --line: #cdddcf;
      --brand: #1f6b2c;
      --brand-soft: #e4f4e7;
      --ok: #166534;
      --ok-soft: #ecfdf3;
      --bad: #b91c1c;
      --bad-soft: #fef2f2;
      --accent: #0e3b70;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Avenir Next", "Segoe UI", sans-serif;
      background: radial-gradient(circle at 10% 5%, #d8ebdc 0%, transparent 30%), linear-gradient(180deg, #f2f8f3, #ecf4ed);
      color: var(--ink);
      padding: 18px;
    }

    .exercise {
      max-width: 980px;
      margin: 0 auto;
      background: var(--card);
      border: 1px solid #d5e2d7;
      border-radius: 16px;
      box-shadow: 0 14px 30px rgba(20, 30, 20, 0.08);
      padding: 18px;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.25rem, 2.8vw, 1.85rem);
      color: var(--brand);
    }

    .lead {
      margin: 8px 0 16px;
      color: var(--muted);
      font-size: 1rem;
      line-height: 1.45;
    }

    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #b9d8bf;
      background: var(--brand-soft);
      color: var(--brand);
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 8px;
    }

    .board {
      display: grid;
      grid-template-columns: minmax(260px, 0.95fr) minmax(340px, 1.05fr);
      gap: 16px;
      align-items: start;
    }

    .panel {
      background: #fbfefb;
      border: 1px solid #d9e6db;
      border-radius: 14px;
      padding: 12px;
    }

    .panel h2 {
      margin: 2px 0 10px;
      font-size: 1.02rem;
      color: #12331a;
    }

    .zone-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .zone-shell {
      border: 1px solid var(--line);
      background: #f5faf6;
      border-radius: 12px;
      padding: 8px;
    }

    .zone-shell h3 {
      margin: 0 0 8px;
      font-size: 0.9rem;
      color: #1e3a2a;
    }

    .dropzone {
      min-height: 120px;
      border: 2px dashed #b9cbbb;
      border-radius: 10px;
      padding: 7px;
      background: #ffffff;
      transition: border-color 0.15s ease, background 0.15s ease;
    }

    .dropzone.over {
      border-color: #2f855a;
      background: #f0fbf2;
    }

    .dropzone.pool {
      min-height: 290px;
      background: #fff;
    }

    .item {
      border: 1px solid #c5d5c8;
      border-radius: 9px;
      padding: 9px 10px;
      background: #fbfffb;
      margin-bottom: 8px;
      cursor: grab;
      font-size: 0.92rem;
      line-height: 1.3;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
      user-select: none;
    }

    .item:last-child { margin-bottom: 0; }

    .item:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 14px rgba(17, 35, 24, 0.08);
    }

    .item.dragging {
      opacity: 0.6;
    }

    .item.selected {
      border-color: #1d4ed8;
      box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.16);
      background: #eff6ff;
    }

    .item.correct {
      border-color: var(--ok);
      background: var(--ok-soft);
      box-shadow: 0 0 0 3px rgba(22, 101, 52, 0.14);
    }

    .item.wrong {
      border-color: var(--bad);
      background: var(--bad-soft);
      box-shadow: 0 0 0 3px rgba(185, 28, 28, 0.14);
    }

    .controls {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    button {
      border: 0;
      border-radius: 10px;
      padding: 10px 13px;
      font: inherit;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.12s ease, filter 0.12s ease;
    }

    button:hover {
      transform: translateY(-1px);
      filter: brightness(1.02);
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
    }

    .btn-neutral {
      background: #edf3ee;
      color: #25332a;
      border: 1px solid #d7e4d8;
    }

    .status {
      margin-left: auto;
      font-size: 0.9rem;
      color: #27472f;
      background: #edf8ee;
      border: 1px solid #c8dfcc;
      padding: 7px 10px;
      border-radius: 999px;
      font-weight: 700;
    }

    .meta {
      margin-top: 10px;
      font-size: 0.86rem;
      color: #54625a;
    }

    .feedback {
      margin-top: 14px;
      border: 1px solid #d9e5da;
      border-radius: 12px;
      padding: 10px 12px;
      background: #fcfefc;
      min-height: 68px;
      font-size: 0.92rem;
    }

    .feedback ul {
      margin: 8px 0 0;
      padding-left: 18px;
    }

    .feedback li { margin-bottom: 6px; }

    .feedback .ok { color: var(--ok); }

    .feedback .bad { color: #7f1d1d; }

    @media (max-width: 760px) {
      .board {
        grid-template-columns: 1fr;
      }

      .zone-grid {
        grid-template-columns: 1fr;
      }

      .status {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <main class="exercise">
    <span class="pill">INTERAKTIVES ELEMENT: Bilanz-Zuordnung</span>
    <h1>Bilanz-Positionen korrekt zuordnen</h1>
    <p class="lead">
      Basis: Schweizer KMU-Kontenplan (Klasse 1 und 2). Ziehe jede Position in den passenden Zielbereich.
      Alternativ: Position anklicken und danach in einen Zielbereich klicken.
    </p>

    <section class="board">
      <article class="panel">
        <h2>Positionen zum Zuordnen</h2>
        <div class="dropzone pool" data-zone="pool" id="pool"></div>
      </article>

      <article class="panel">
        <h2>Zielbereiche (Schweizer Reihenfolge)</h2>
        <div class="zone-grid">
          <section class="zone-shell">
            <h3>Aktiven (Umlaufvermögen)</h3>
            <div class="dropzone" data-zone="asset_current"></div>
          </section>
          <section class="zone-shell">
            <h3>Passiven (Fremdkapital)</h3>
            <div class="dropzone" data-zone="liability_debt"></div>
          </section>
          <section class="zone-shell">
            <h3>Aktiven (Anlagevermögen)</h3>
            <div class="dropzone" data-zone="asset_fixed"></div>
          </section>
          <section class="zone-shell">
            <h3>Passiven (Eigenkapital)</h3>
            <div class="dropzone" data-zone="liability_equity"></div>
          </section>
        </div>
      </article>
    </section>

    <div class="controls">
      <button type="button" class="btn-primary" id="checkBtn">Antworten prüfen</button>
      <button type="button" class="btn-neutral" id="resetBtn">Nächste Übung (neue Konten)</button>
      <button type="button" class="btn-neutral" id="solveBtn">Lösung anzeigen</button>
      <span class="status" id="progress">Übung 0: 0/0 zugeordnet</span>
    </div>

    <p class="meta">
      Feedback bei richtiger Zuordnung: kurze fachliche Einordnung. Bei falscher Zuordnung: Hinweis auf den Unterschied zwischen Mittelverwendung (Aktiven) und Mittelherkunft (Passiven).
      Bei jeder nächsten Übung werden neue Konten aus dem KMU-Kontenplan gemischt.
    </p>

    <section class="feedback" id="feedback">
      Starte mit Drag-and-Drop und klicke danach auf <strong>Antworten prüfen</strong>.
    </section>
  </main>

  <script>
    const zoneConfig = {
      asset_current: {
        title: "Aktiven (Umlaufvermögen)",
        explanation: "Richtig: Diese Position gehört im KMU-Kontenplan zur Klasse 1 (Umlaufvermögen).",
        hint: "Prüfe, ob es sich um einen kurzfristigen Vermögenswert handelt (Mittelverwendung)."
      },
      asset_fixed: {
        title: "Aktiven (Anlagevermögen)",
        explanation: "Richtig: Diese Position wird als langfristiger Vermögenswert im Anlagevermögen geführt.",
        hint: "Prüfe, ob der Vermögenswert dem Unternehmen langfristig dient (Mittelverwendung)."
      },
      liability_debt: {
        title: "Passiven (Fremdkapital)",
        explanation: "Richtig: Diese Position ist Fremdkapital und damit Teil der Passiven (Mittelherkunft).",
        hint: "Besteht eine Verpflichtung gegenüber Dritten? Dann liegt oft Fremdkapital vor."
      },
      liability_equity: {
        title: "Passiven (Eigenkapital)",
        explanation: "Richtig: Diese Position gehört zum Eigenkapital und damit zur Passivseite.",
        hint: "Frage dich, ob die Mittel den Eigentümerinnen und Eigentümern zuzurechnen sind."
      }
    };

    const accountPool = [
      { id: "1000", text: "1000 Kasse", correctZone: "asset_current" },
      { id: "1020", text: "1020 Bank", correctZone: "asset_current" },
      { id: "1060", text: "1060 Wertschriften (kurzfristig)", correctZone: "asset_current" },
      { id: "1100", text: "1100 Forderungen aus L+L", correctZone: "asset_current" },
      { id: "1140", text: "1140 Sonstige kurzfristige Forderungen", correctZone: "asset_current" },
      { id: "1170", text: "1170 Vorsteuer MWST", correctZone: "asset_current" },
      { id: "1200", text: "1200 Vorrat Handelswaren", correctZone: "asset_current" },
      { id: "1300", text: "1300 Aktive Rechnungsabgrenzung", correctZone: "asset_current" },

      { id: "1440", text: "1440 Darlehen (langfristig)", correctZone: "asset_fixed" },
      { id: "1480", text: "1480 Beteiligungen", correctZone: "asset_fixed" },
      { id: "1500", text: "1500 Maschinen und Apparate", correctZone: "asset_fixed" },
      { id: "1510", text: "1510 Mobiliar", correctZone: "asset_fixed" },
      { id: "1530", text: "1530 Fahrzeuge", correctZone: "asset_fixed" },
      { id: "1600", text: "1600 Geschäftsliegenschaft", correctZone: "asset_fixed" },
      { id: "1700", text: "1700 Patente und Lizenzen", correctZone: "asset_fixed" },
      { id: "1770", text: "1770 Goodwill", correctZone: "asset_fixed" },

      { id: "2000", text: "2000 Verbindlichkeiten aus L+L", correctZone: "liability_debt" },
      { id: "2100", text: "2100 Kurzfristige Finanzverbindlichkeiten", correctZone: "liability_debt" },
      { id: "2200", text: "2200 Geschuldete MWST", correctZone: "liability_debt" },
      { id: "2300", text: "2300 Passive Rechnungsabgrenzung", correctZone: "liability_debt" },
      { id: "2330", text: "2330 Kurzfristige Rückstellungen", correctZone: "liability_debt" },
      { id: "2400", text: "2400 Langfristige Finanzverbindlichkeiten", correctZone: "liability_debt" },
      { id: "2450", text: "2450 Hypotheken", correctZone: "liability_debt" },
      { id: "2600", text: "2600 Langfristige Rückstellungen", correctZone: "liability_debt" },

      { id: "2800", text: "2800 Aktienkapital", correctZone: "liability_equity" },
      { id: "2850", text: "2850 Inhaber-/Stammkapital", correctZone: "liability_equity" },
      { id: "2900", text: "2900 Gesetzliche Gewinnreserve", correctZone: "liability_equity" },
      { id: "2950", text: "2950 Freiwillige Gewinnreserve", correctZone: "liability_equity" },
      { id: "2970", text: "2970 Gewinnvortrag", correctZone: "liability_equity" },
      { id: "2980", text: "2980 Jahresgewinn oder Jahresverlust", correctZone: "liability_equity" }
    ];

    const cardsPerZone = {
      asset_current: 2,
      liability_debt: 2,
      asset_fixed: 2,
      liability_equity: 2
    };

    const feedbackEl = document.getElementById("feedback");
    const progressEl = document.getElementById("progress");
    const poolEl = document.getElementById("pool");
    const checkBtn = document.getElementById("checkBtn");
    const resetBtn = document.getElementById("resetBtn");
    const solveBtn = document.getElementById("solveBtn");
    const dropzones = Array.from(document.querySelectorAll(".dropzone"));

    let selectedCard = null;
    let currentItems = [];
    let exerciseNumber = 0;
    let lastExerciseIds = new Set();

    function shuffle(list) {
      const arr = [...list];
      for (let i = arr.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function withFeedbackData(account) {
      const zone = zoneConfig[account.correctZone];
      return {
        ...account,
        explanation: `${zone.explanation} (${zone.title})`,
        hint: `${zone.hint} Orientiere dich an Aktivseite = Mittelverwendung, Passivseite = Mittelherkunft.`
      };
    }

    function pickAccountsForZone(zone, count, avoidIds) {
      const pool = accountPool.filter((acc) => acc.correctZone === zone);
      const preferred = shuffle(pool.filter((acc) => !avoidIds.has(acc.id)));
      if (preferred.length >= count) return preferred.slice(0, count);

      const fallback = shuffle(pool.filter((acc) => avoidIds.has(acc.id)));
      return [...preferred, ...fallback].slice(0, count);
    }

    function buildNextExercise() {
      const selected = [];
      for (const [zone, count] of Object.entries(cardsPerZone)) {
        selected.push(...pickAccountsForZone(zone, count, lastExerciseIds));
      }

      currentItems = shuffle(selected).map(withFeedbackData);
      lastExerciseIds = new Set(currentItems.map((item) => item.id));
      exerciseNumber += 1;
    }

    function createCard(item) {
      const card = document.createElement("article");
      card.className = "item";
      card.id = item.id;
      card.draggable = true;
      card.textContent = item.text;
      card.dataset.correctZone = item.correctZone;
      card.dataset.explanation = item.explanation;
      card.dataset.hint = item.hint;

      card.addEventListener("dragstart", (event) => {
        event.dataTransfer.setData("text/plain", card.id);
        card.classList.add("dragging");
        selectedCard = null;
        clearSelection();
      });

      card.addEventListener("dragend", () => {
        card.classList.remove("dragging");
      });

      card.addEventListener("click", (event) => {
        event.stopPropagation();
        if (selectedCard === card) {
          selectedCard = null;
          clearSelection();
          return;
        }

        selectedCard = card;
        clearSelection();
        card.classList.add("selected");
      });

      return card;
    }

    function clearSelection() {
      document.querySelectorAll(".item.selected").forEach((itemEl) => itemEl.classList.remove("selected"));
    }

    function clearEvaluation() {
      document.querySelectorAll(".item").forEach((itemEl) => {
        itemEl.classList.remove("correct", "wrong");
      });
    }

    function bindDropzone(zoneEl) {
      zoneEl.addEventListener("dragover", (event) => {
        event.preventDefault();
        zoneEl.classList.add("over");
      });

      zoneEl.addEventListener("dragleave", () => {
        zoneEl.classList.remove("over");
      });

      zoneEl.addEventListener("drop", (event) => {
        event.preventDefault();
        zoneEl.classList.remove("over");
        const id = event.dataTransfer.getData("text/plain");
        const card = document.getElementById(id);
        if (!card) return;
        zoneEl.appendChild(card);
        clearEvaluation();
        updateProgress();
      });

      zoneEl.addEventListener("click", () => {
        if (!selectedCard) return;
        zoneEl.appendChild(selectedCard);
        selectedCard = null;
        clearSelection();
        clearEvaluation();
        updateProgress();
      });
    }

    function getAssignedCount() {
      return document.querySelectorAll(".dropzone:not([data-zone='pool']) .item").length;
    }

    function updateProgress() {
      const assigned = getAssignedCount();
      progressEl.textContent = `Übung ${exerciseNumber}: ${assigned}/${currentItems.length} zugeordnet`;
    }

    function resetExercise(nextExercise = false) {
      if (nextExercise || currentItems.length === 0) {
        buildNextExercise();
      }

      selectedCard = null;
      clearSelection();
      clearEvaluation();
      feedbackEl.innerHTML = "Starte mit Drag-and-Drop und klicke danach auf <strong>Antworten prüfen</strong>.";

      poolEl.innerHTML = "";
      for (const zoneEl of dropzones) {
        if (zoneEl !== poolEl) zoneEl.innerHTML = "";
      }

      currentItems.forEach((item) => {
        poolEl.appendChild(createCard(item));
      });

      updateProgress();
    }

    function checkAnswers() {
      const assigned = getAssignedCount();
      if (assigned < currentItems.length) {
        feedbackEl.innerHTML = `Noch nicht vollständig: <strong>${assigned}/${currentItems.length}</strong> Positionen sind zugeordnet.`;
        return;
      }

      clearSelection();
      const results = [];
      let correctCount = 0;

      document.querySelectorAll(".item").forEach((card) => {
        const zone = card.closest(".dropzone").dataset.zone;
        const isCorrect = zone === card.dataset.correctZone;
        card.classList.remove("correct", "wrong");
        card.classList.add(isCorrect ? "correct" : "wrong");

        if (isCorrect) {
          correctCount += 1;
          results.push(`<li class="ok"><strong>${card.textContent}:</strong> ${card.dataset.explanation}</li>`);
        } else {
          results.push(`<li class="bad"><strong>${card.textContent}:</strong> Noch nicht korrekt. ${card.dataset.hint}</li>`);
        }
      });

      if (correctCount === currentItems.length) {
        feedbackEl.innerHTML = `<strong>Sehr gut: ${correctCount}/${currentItems.length} korrekt.</strong><ul>${results.join("")}</ul>`;
      } else {
        feedbackEl.innerHTML = `<strong>${correctCount}/${currentItems.length} korrekt.</strong> Nutze die Hinweise und ordne die roten Karten neu zu.<ul>${results.join("")}</ul>`;
      }
    }

    function showSolution() {
      clearSelection();
      clearEvaluation();

      currentItems.forEach((item) => {
        const card = document.getElementById(item.id);
        const target = document.querySelector(`.dropzone[data-zone='${item.correctZone}']`);
        target.appendChild(card);
        card.classList.add("correct");
      });

      updateProgress();
      feedbackEl.innerHTML = "Musterlösung eingeblendet. Alle Positionen sind korrekt zugeordnet.";
    }

    dropzones.forEach(bindDropzone);
    checkBtn.addEventListener("click", checkAnswers);
    resetBtn.addEventListener("click", () => resetExercise(true));
    solveBtn.addEventListener("click", showSolution);

    resetExercise(true);
  </script>
</body>
</html>
